# 数据模型

本文档定义了刷题应用中使用的核心数据模型结构，包括科目、题目、用户和用户行为等。

## 1. 科目 (Subject)

```typescript
interface Subject {
  _id: string; // MongoDB 文档 ID
  id: string; // 业务 ID
  name: string; // 科目名称
  code: string; // 科目代码（唯一标识）
  description: string; // 科目描述
  tags: Array<{
    name: string; // 标签名称
    value: string; // 标签值
  }>; // 科目包含的标签列表
  userTags: Array<{
    name: string; // 用户自定义标签名称
    value: string; // 用户自定义标签值
  }>; // 用户自定义标签列表
  difficultyLevels: Array<{
    name: string; // 难度名称
    value: string; // 难度值
  }>; // 科目支持的难度级别
  isEnabled: boolean; // 科目是否启用
  createdAt: string; // 创建时间（ISO 格式字符串）
  updatedAt: string; // 更新时间（ISO 格式字符串）
}
```

**字段说明**:

- `_id`: MongoDB 自动生成的唯一标识
- `id`: 业务层面的唯一标识符
- `name`: 科目名称，如 "前端开发面试"
- `code`: 科目代码，通常为大写缩写，如 "FE_INTERVIEW"
- `description`: 科目详细描述
- `tags`: 系统预设的标签列表
- `userTags`: 用户可以添加的自定义标签列表
- `difficultyLevels`: 科目的难度级别列表
- `isEnabled`: 表示科目是否可用
- `createdAt`: 创建时间戳
- `updatedAt`: 最后更新时间戳

## 2. 题目 (Question)

```typescript
interface Question {
  _id: string; // MongoDB 文档 ID
  id: string; // 业务 ID
  type: string; // 题目类型：choice、blank、true_false、essay
  difficulty: string; // 难度级别：easy、medium、hard
  tags: string[]; // 题目标签（值数组）
  question_markdown: string; // 题目内容（Markdown 格式）
  answer_simple_markdown: string; // 参考答案（简洁版，Markdown 格式）
  answer_detailed_markdown?: string; // 参考答案（详细版，Markdown 格式）
  options?: Array<{
    id: string; // 选项 ID
    text: string; // 选项文本
  }>; // 选择题选项（仅当 type 为 choice 时存在）
  correctAnswers?: string[]; // 正确答案（选项 ID 数组，仅当 type 为 choice 时存在）
  subjectId: string; // 所属科目 ID
  isEnabled: boolean; // 题目是否启用
  createdAt: string; // 创建时间（ISO 格式字符串）
  updatedAt: string; // 更新时间（ISO 格式字符串）
  stats?: {
    totalAttempts: number; // 总答题次数
    correctAttempts: number; // 正确答题次数
    passRate: number; // 通过率
  }; // 统计数据
  deleted?: boolean; // 是否已删除
}
```

**字段说明**:

- `_id`: MongoDB 自动生成的唯一标识
- `id`: 业务层面的唯一标识符
- `type`: 题目类型，包括选择题、填空题、判断题、简答题等
- `difficulty`: 题目难度级别
- `tags`: 题目标签数组
- `question_markdown`: 题目内容，支持 Markdown 格式
- `answer_simple_markdown`: 简洁版参考答案，支持 Markdown 格式
- `answer_detailed_markdown`: 可选的详细版参考答案
- `options`: 选择题的选项列表，仅当 `type` 为 `choice` 时存在
- `correctAnswers`: 正确答案的选项 ID 数组，仅当 `type` 为 `choice` 时存在
- `subjectId`: 所属科目 ID
- `isEnabled`: 表示题目是否可用
- `createdAt`: 创建时间戳
- `updatedAt`: 最后更新时间戳
- `stats`: 可选的题目统计数据
- `deleted`: 可选字段，表示题目是否被逻辑删除

## 3. 用户 (User)

```typescript
interface User {
  _id: string; // MongoDB 文档 ID
  id: string; // 业务 ID
  username: string; // 用户名
  email: string; // 邮箱地址
  phone?: string; // 手机号（可选）
  avatar?: string; // 头像 URL（可选）
  role: string; // 用户角色：admin、user、guest
  isActive: boolean; // 用户是否激活
  lastLogin?: string; // 最后登录时间（ISO 格式字符串）
  createdAt: string; // 创建时间（ISO 格式字符串）
  updatedAt: string; // 更新时间（ISO 格式字符串）
}
```

**字段说明**:

- `_id`: MongoDB 自动生成的唯一标识
- `id`: 业务层面的唯一标识符
- `username`: 用户名，登录凭证
- `email`: 邮箱地址，用于找回密码等
- `phone`: 可选的手机号
- `avatar`: 可选的用户头像 URL
- `role`: 用户角色，决定权限
- `isActive`: 表示用户是否活跃
- `lastLogin`: 可选的最后登录时间
- `createdAt`: 创建时间戳
- `updatedAt`: 最后更新时间戳

## 4. 用户行为 (UserAction)

```typescript
interface UserAction {
  _id: string; // MongoDB 文档 ID
  userId: string; // 用户 ID
  questionId: string; // 题目 ID
  action: string; // 行为类型：favorited、deleted、attempted、selected_subject
  metadata?: object; // 行为附加信息（如选择了什么答案等）
  createdAt: string; // 创建时间（ISO 格式字符串）
  updatedAt: string; // 更新时间（ISO 格式字符串）
}
```

**字段说明**:

- `_id`: MongoDB 自动生成的唯一标识
- `userId`: 用户 ID
- `questionId`: 相关题目的 ID
- `action`: 行为类型，如收藏、删除、尝试答题等
- `metadata`: 可选的附加信息，根据行为类型不同而不同
- `createdAt`: 创建时间戳
- `updatedAt`: 最后更新时间戳

## 5. 选择科目记录 (SelectedSubject)

```typescript
interface SelectedSubject {
  _id: string; // MongoDB 文档 ID
  userId: string; // 用户 ID
  subjectId: string; // 选择的科目 ID
  lastSelected: string; // 最后选择时间（ISO 格式字符串）
  createdAt: string; // 创建时间（ISO 格式字符串）
  updatedAt: string; // 更新时间（ISO 格式字符串）
}
```

**字段说明**:

- `_id`: MongoDB 自动生成的唯一标识
- `userId`: 用户 ID
- `subjectId`: 用户选择的科目 ID
- `lastSelected`: 最后选择该科目的时间
- `createdAt`: 创建时间戳
- `updatedAt`: 最后更新时间戳

## 6. 统一响应格式 (ApiResponse)

```typescript
interface ApiResponse<T = any> {
  success: boolean; // 请求是否成功
  data: T; // 响应数据
  message: string; // 响应消息
}
```

**字段说明**:

- `success`: 表示 API 请求是否成功
- `data`: 具体的响应数据，类型可根据不同接口定义
- `message`: 响应消息，通常包含成功提示或错误信息

## 7. 分页结果 (PaginationResult)

```typescript
interface PaginationResult<T = any> {
  items: T[]; // 分页数据列表
  pagination: {
    page: number; // 当前页码
    limit: number; // 每页数量
    total: number; // 总数量
    totalPages: number; // 总页数
    hasNext: boolean; // 是否有下一页
    hasPrev: boolean; // 是否有上一页
  };
}
```

**字段说明**:

- `items`: 分页返回的数据列表
- `pagination`: 分页信息对象
  - `page`: 当前页码
  - `limit`: 每页显示数量
  - `total`: 总数据条数
  - `totalPages`: 总页数
  - `hasNext`: 是否有下一页
  - `hasPrev`: 是否有上一页
