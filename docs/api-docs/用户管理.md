# 用户管理 API

本文档包含所有与用户管理相关的 API 接口，包括注册、认证、信息获取和密码管理。

## 0. 用户注册

**接口地址**: `POST /users/register`

**接口描述**: 新用户注册账号

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| username | string | body | 是 | 用户名 |
| password | string | body | 是 | 密码 |
| email | string | body | 否 | 邮箱地址（选填） |

**请求示例**:

```
POST http://localhost:3000/users/register
Content-Type: application/json

{
  "username": "newuser",
  "password": "password123"
}
```

或者包含邮箱的示例：

```
POST http://localhost:3000/users/register
Content-Type: application/json

{
  "username": "newuser",
  "password": "password123",
  "email": "newuser@example.com"
}
```

**响应示例**:

当不提供邮箱时：

```json
{
  "success": true,
  "data": {
    "userId": "64f1a2b3c4d5e6f789012348",
    "username": "newuser",
    "email": null
  },
  "message": "注册成功"
}
```

当提供邮箱时：

```json
{
  "success": true,
  "data": {
    "userId": "64f1a2b3c4d5e6f789012348",
    "username": "newuser",
    "email": "newuser@example.com"
  },
  "message": "注册成功"
}
```

**错误响应**:

```json
{
  "success": false,
  "data": null,
  "message": "缺少必要参数: username 和 password"
}
```

如果提供了邮箱但邮箱已被注册：

```json
{ "success": false, "data": null, "message": "邮箱已被注册" }
```

或

```json
{ "success": false, "data": null, "message": "用户名已存在" }
```

或

```json
{ "success": false, "data": null, "message": "邮箱已被注册" }
```

## 1. 用户登录

**接口地址**: `POST /users/login`

**接口描述**: 用户登录，支持用户名/密码或邮箱/密码两种方式登录，获取用户身份认证信息和 token

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| username | string | body | 否 | 用户名（与 email 至少填一项） |
| email | string | body | 否 | 邮箱（与 username 至少填一项） |
| password | string | body | 是 | 密码 |

**请求示例**:

```
POST http://localhost:3000/user-actions/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}
```

**响应示例**:

```json
{
  "success": true,
  "data": {
    "userId": "64f1a2b3c4d5e6f789012347",
    "username": "admin",
    "role": "admin",
    "token": "token_64f1a2b3c4d5e6f789012347_1622544000000_abc123def456",
    "lastLogin": "2021-06-01T10:00:00.000Z",
    "email": "admin@example.com"
  },
  "message": "登录成功"
}
```

**错误响应**:

```json
{
  "success": false,
  "data": null,
  "message": "缺少必要参数: username 和 password"
}
```

或

```json
{ "success": false, "data": null, "message": "用户名或密码错误" }
```

## 2. 用户退出登录

**接口地址**: `POST /users/logout`

**接口描述**: 用户退出登录，清除用户身份认证信息

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| userId | string | body | 是 | 用户 ID |
| token | string | body | 是 | 用户登录时获取的 token |

**请求示例**:

```
POST http://localhost:3000/user-actions/logout
Content-Type: application/json

{
  "userId": "64f1a2b3c4d5e6f789012347",
  "token": "token_64f1a2b3c4d5e6f789012347_1622544000000_abc123def456"
}
```

**响应示例**:

```json
{
  "success": true,
  "data": null,
  "message": "退出登录成功"
}
```

**错误响应**:

```json
{ "success": false, "data": null, "message": "缺少必要参数: userId 和 token" }
```

## 3. 获取用户信息

**接口地址**: `GET /users/info`

**接口描述**: 获取用户信息，用于判断用户是否已登录及验证登录状态有效性

**使用场景**:

- 应用启动时检查用户是否已登录
- 定时验证登录状态有效性
- 获取当前登录用户的基本信息

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| token | string | query/header | 是 | 用户登录时获取的 token，推荐使用请求头：Authorization: Bearer {token} |

**请求示例** (使用查询参数):

```
GET http://localhost:3000/user-actions/user-info?token=token_64f1a2b3c4d5e6f789012347_1622544000000_abc123def456
```

**请求示例** (使用请求头):

```
GET http://localhost:3000/user-actions/user-info
Authorization: Bearer token_64f1a2b3c4d5e6f789012347_1622544000000_abc123def456
```

**响应示例** (已登录):

```json
{
  "success": true,
  "data": {
    "userId": "64f1a2b3c4d5e6f789012347",
    "username": "admin",
    "role": "admin",
    "lastLogin": "2021-06-01T10:00:00.000Z",
    "isLoggedIn": true,
    "email": "admin@example.com"
  },
  "message": "获取用户信息成功"
}
```

**错误响应** (token 缺失):

```json
{ "success": false, "data": null, "message": "缺少必要参数: token" }
```

**错误响应** (无效的登录状态):

```json
{ "success": false, "data": null, "message": "无效的登录状态，请重新登录" }
```

## 4. 忘记密码

**接口地址**: `POST /users/forgot-password`

**接口描述**: 用户忘记密码时，发送验证码到用户邮箱（移动 App 重置密码流程）

**使用场景**: 用户忘记密码，需要通过邮箱获取验证码后重置密码

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| email | string | body | 是 | 用户注册时使用的邮箱 |

**请求示例**:

```
POST http://localhost:3000/user-actions/forgot-password
Content-Type: application/json

{
  "email": "user@example.com"
}
```

**响应示例**:

成功（无论邮箱是否存在，为了安全都返回相同消息）：

```json
{
  "success": true,
  "data": null,
  "message": "如果该邮箱存在，我们已发送验证码"
}
```

失败（参数缺失）：

```json
{
  "success": false,
  "data": null,
  "message": "缺少必要参数: email"
}
```

## 5. 重置密码

**接口地址**: `POST /users/reset-password`

**接口描述**: 用户在 App 中输入验证码后重置密码

**使用场景**: 用户在 App 中输入邮箱和验证码后，设置新密码

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| email | string | body | 是 | 用户注册时使用的邮箱 |
| verificationCode | string | body | 是 | 验证码（从邮件中获取） |
| newPassword | string | body | 是 | 新密码 |

**请求示例**:

```
POST http://localhost:3000/user-actions/reset-password
Content-Type: application/json

{
  "email": "user@example.com",
  "verificationCode": "123456",
  "newPassword": "new_password123"
}
```

**响应示例**:

成功：

```json
{
  "success": true,
  "data": null,
  "message": "密码重置成功，请使用新密码登录"
}
```

失败（参数缺失）：

```json
{
  "success": false,
  "data": null,
  "message": "缺少必要参数: email、verificationCode 和 newPassword"
}
```

失败（找不到该邮箱对应的用户）：

````json
{
  "success": false,
  "data": null,
  "message": "找不到该邮箱对应的用户"
}

失败（无效或已过期的验证码）：
```json
{
  "success": false,
  "data": null,
  "message": "无效或已过期的验证码"
}
````
