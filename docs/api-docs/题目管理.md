# 题目管理 API

本文档包含所有与题目管理相关的 API 接口。

## 1. 随机获取题目

**接口地址**: `GET /questions/random`

**接口描述**: 随机获取一道题目

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| subjectId | string | query | 否 | 科目 ID |
| difficulty | string | query | 否 | 难度等级：easy、medium、hard |
| excludeIds | string | query | 否 | 排除的题目 ID，多个用逗号分隔 |
| tags | string | query | 否 | 标签过滤，多个用逗号分隔 |

**请求示例**:

```
# 获取任意一道题目
GET http://localhost:3000/questions/random

# 获取指定科目的题目
GET http://localhost:3000/questions/random?subjectId=64f1a2b3c4d5e6f789012345

# 获取指定难度的题目
GET http://localhost:3000/questions/random?difficulty=medium

# 获取指定标签的题目
GET http://localhost:3000/questions/random?tags=javascript,react
```

**响应示例**:

```json
{
  "success": true,
  "data": {
    "_id": "64f1a2b3c4d5e6f789012346",
    "id": "285acd89-b79b-49e6-8425-5d60d5101233",
    "type": "choice",
    "difficulty": "easy",
    "tags": ["vue", "lifecycle"],
    "question_markdown": "Vue 2.x 生命周期有哪些？分别做了什么？",
    "answer_simple_markdown": "beforeCreate → created → beforeMount → mounted...",
    "answer_analysis_markdown": "详细解析内容...",
    "files": {
      "audio_simple": "path/to/audio_simple.mp3",
      "audio_question": "path/to/audio_question.mp3",
      "audio_analysis": "path/to/audio_analysis.mp3",
      "meta": "path/to/meta.json"
    },
    "subjectId": "64f1a2b3c4d5e6f789012345",
    "question_length": 25,
    "simple_answer_length": 120,
    "detailed_analysis_length": 500,
    "created_at": "2023-09-01T10:00:00.000Z"
  },
  "message": "操作成功"
}
```

**错误响应**:

```json
{ "success": false, "data": null, "message": "暂无符合条件的题目" }
```

## 2. 随机获取题目列表

**接口地址**: `POST /questions/random-list`

**接口描述**: 随机获取指定数量的题目列表

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| subjectId | string | body | 否 | 科目 ID |
| total | number | body | 否 | 题目数量，默认 10，最大 50 |
| difficultyConfig | object | body | 否 | 难度分布配置，例如：{"easy": 0.4, "medium": 0.4, "hard": 0.2} |
| excludeIds | array | body | 否 | 排除的题目 ID 数组 |
| tags | array | body | 否 | 标签过滤数组 |

**请求示例**:

```
# 随机获取 10 道题目
POST http://localhost:3000/questions/random-list
Content-Type: application/json

{}

# 随机获取指定科目的 20 道题目
POST http://localhost:3000/questions/random-list
Content-Type: application/json

{
  "subjectId": "64f1a2b3c4d5e6f789012345",
  "total": 20
}

# 自定义难度分布
POST http://localhost:3000/questions/random-list
Content-Type: application/json

{
  "subjectId": "64f1a2b3c4d5e6f789012345",
  "total": 20,
  "difficultyConfig": {
    "easy": 0.3,
    "medium": 0.5,
    "hard": 0.2
  }
}

# 按标签过滤
POST http://localhost:3000/questions/random-list
Content-Type: application/json

{
  "subjectId": "64f1a2b3c4d5e6f789012345",
  "tags": ["vue", "javascript"]
}
```

**响应示例**:

```json
{
  "success": true,
  "data": {
    "questions": [
      {
        "_id": "64f1a2b3c4d5e6f789012346",
        "id": "285acd89-b79b-49e6-8425-5d60d5101233",
        "type": "choice",
        "difficulty": "easy",
        "tags": ["vue", "lifecycle"],
        "question_markdown": "Vue 2.x 生命周期有哪些？分别做了什么？",
        "answer_simple_markdown": "beforeCreate → created → beforeMount → mounted...",
        "answer_analysis_markdown": "详细解析内容...",
        "files": {
          "audio_simple": "path/to/audio_simple.mp3",
          "audio_question": "path/to/audio_question.mp3",
          "audio_analysis": "path/to/audio_analysis.mp3",
          "meta": "path/to/meta.json"
        },
        "subjectId": "64f1a2b3c4d5e6f789012345",
        "question_length": 25,
        "simple_answer_length": 120,
        "detailed_analysis_length": 500,
        "created_at": "2023-09-01T10:00:00.000Z"
      }
      // 更多题目...
    ],
    "stats": {
      "total": 10,
      "easy": 4,
      "medium": 4,
      "hard": 2,
      "tags": {
        "vue": 6,
        "javascript": 5,
        "react": 3
      }
    }
  },
  "message": "操作成功"
}
```

**错误响应**:

```json
{ "success": false, "data": null, "message": "暂无符合条件的题目" }
```

## 3. 获取过滤的题目列表

**接口地址**: `POST /questions/list`

**接口描述**: 根据条件过滤题目并返回分页列表

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| subjectId | string | body | 否 | 科目 ID |
| difficulty | array | body | 否 | 难度等级数组，例如：["easy", "medium"] |
| tags | array | body | 否 | 标签数组，例如：["vue", "javascript"] |
| searchKeyword | string | body | 否 | 搜索关键字，用于模糊匹配题目内容、答案和分析 |
| page | number | body | 否 | 页码，默认 1 |
| limit | number | body | 否 | 每页数量，默认 20，最大 50 |

**请求示例**:

```
# 获取所有题目（分页）
POST http://localhost:3000/questions/list
Content-Type: application/json

{
  "page": 1,
  "limit": 10
}

# 根据条件过滤题目
POST http://localhost:3000/questions/list
Content-Type: application/json

{
  "subjectId": "64f1a2b3c4d5e6f789012345",
  "difficulty": ["easy", "medium"],
  "tags": ["vue", "javascript"],
  "page": 1,
  "limit": 10
}

# 使用搜索关键字
POST http://localhost:3000/questions/list
Content-Type: application/json

{
  "searchKeyword": "Vue 生命周期",
  "page": 1,
  "limit": 10
}
```

**响应示例**:

```json
{
  "success": true,
  "data": {
    "questions": [
      {
        "_id": "64f1a2b3c4d5e6f789012346",
        "id": "285acd89-b79b-49e6-8425-5d60d5101233",
        "type": "choice",
        "difficulty": "easy",
        "tags": ["vue", "lifecycle"],
        "question_markdown": "Vue 2.x 生命周期有哪些？分别做了什么？",
        "answer_simple_markdown": "beforeCreate → created → beforeMount → mounted...",
        "answer_analysis_markdown": "详细解析内容...",
        "files": {
          "audio_simple": "path/to/audio_simple.mp3",
          "audio_question": "path/to/audio_question.mp3",
          "audio_analysis": "path/to/audio_analysis.mp3",
          "meta": "path/to/meta.json"
        },
        "subjectId": "64f1a2b3c4d5e6f789012345",
        "question_length": 25,
        "simple_answer_length": 120,
        "detailed_analysis_length": 500,
        "created_at": "2023-09-01T10:00:00.000Z"
      }
      // 更多题目...
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 120,
      "totalPages": 12,
      "hasNext": true,
      "hasPrev": false
    },
    "filters": {
      "searchKeyword": "Vue 生命周期",
      "subjectId": "64f1a2b3c4d5e6f789012345",
      "difficulty": ["easy", "medium"],
      "tags": ["vue", "javascript"]
    }
  },
  "message": "操作成功"
}
```

**错误响应**:

```json
{ "success": false, "data": null, "message": "暂无符合条件的题目" }
```

## 4. 根据 ID 获取题目详情

**接口地址**: `GET /questions/:id`

**接口描述**: 根据题目 ID 获取题目详情

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| id | string | path | 是 | 题目 ID |

**请求示例**:

```
GET http://localhost:3000/questions/64f1a2b3c4d5e6f789012346
```

**响应示例**:

```json
{
  "success": true,
  "data": {
    "_id": "64f1a2b3c4d5e6f789012346",
    "id": "285acd89-b79b-49e6-8425-5d60d5101233",
    "type": "choice",
    "difficulty": "easy",
    "tags": ["vue", "lifecycle"],
    "question_markdown": "Vue 2.x 生命周期有哪些？分别做了什么？",
    "answer_simple_markdown": "beforeCreate → created → beforeMount → mounted...",
    "answer_analysis_markdown": "详细解析内容...",
    "files": {
      "audio_simple": "path/to/audio_simple.mp3",
      "audio_question": "path/to/audio_question.mp3",
      "audio_analysis": "path/to/audio_analysis.mp3",
      "meta": "path/to/meta.json"
    },
    "subjectId": "64f1a2b3c4d5e6f789012345",
    "question_length": 25,
    "simple_answer_length": 120,
    "detailed_analysis_length": 500,
    "created_at": "2023-09-01T10:00:00.000Z"
  },
  "message": "操作成功"
}
```

**错误响应**:

```json
{ "success": false, "data": null, "message": "题目不存在" }
```

## 5. 新增题目

**接口地址**: `POST /questions`

**接口描述**: 创建一道新题目

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| type | string | body | 是 | 题目类型 |
| difficulty | string | body | 是 | 难度等级：easy、medium、hard |
| tags | array | body | 是 | 标签数组 |
| question_markdown | string | body | 是 | 题目内容（Markdown 格式） |
| answer_simple_markdown | string | body | 是 | 简单答案（Markdown 格式） |
| answer_analysis_markdown | string | body | 是 | 详细解析（Markdown 格式） |
| subjectId | string | body | 是 | 科目 ID |
| category | string | body | 否 | 题目分类 |
| files | object | body | 否 | 文件信息对象，包含音频和元数据路径 |

**请求示例**:

```
POST http://localhost:3000/questions
Content-Type: application/json

{
  "type": "choice",
  "difficulty": "medium",
  "tags": ["javascript", "async"],
  "question_markdown": "async/await 的底层实现原理是什么？如何处理 async 函数中的错误？",
  "answer_simple_markdown": "async/await 是基于 Promise 的语法糖...",
  "answer_analysis_markdown": "详细解析 async/await 的实现原理...",
  "subjectId": "64f1a2b3c4d5e6f789012345",
  "category": "JavaScript基础",
  "files": {
    "audio_simple": "path/to/audio_simple.mp3",
    "audio_question": "path/to/audio_question.mp3",
    "audio_analysis": "path/to/audio_analysis.mp3",
    "meta": "path/to/meta.json"
  }
}
```

**响应示例**:

```json
{
  "success": true,
  "data": {
    "_id": "65f1a2b3c4d5e6f789012346",
    "id": "285acd89-b79b-49e6-8425-5d60d5101234",
    "type": "choice",
    "difficulty": "medium",
    "tags": ["javascript", "async"],
    "question_markdown": "async/await 的底层实现原理是什么？如何处理 async 函数中的错误？",
    "answer_simple_markdown": "async/await 是基于 Promise 的语法糖...",
    "answer_analysis_markdown": "详细解析 async/await 的实现原理...",
    "files": {
      "audio_simple": "path/to/audio_simple.mp3",
      "audio_question": "path/to/audio_question.mp3",
      "audio_analysis": "path/to/audio_analysis.mp3",
      "meta": "path/to/meta.json"
    },
    "subjectId": "64f1a2b3c4d5e6f789012345",
    "category": "JavaScript基础",
    "question_length": 50,
    "simple_answer_length": 150,
    "detailed_analysis_length": 600,
    "createdAt": "2024-05-20T10:00:00.000Z",
    "updatedAt": "2024-05-20T10:00:00.000Z"
  },
  "message": "题目创建成功"
}
```

**错误响应**:

```json
{ "success": false, "data": null, "message": "缺少必要的题目信息" }
```

## 6. 编辑题目

**接口地址**: `PUT /questions/:id`

**接口描述**: 根据题目 ID 更新题目信息

**请求参数**:
| 参数名 | 类型 | 位置 | 必填 | 说明 |
|--------|------|------|------|------|
| id | string | path | 是 | 题目 ID |
| type | string | body | 否 | 题目类型 |
| difficulty | string | body | 否 | 难度等级：easy、medium、hard |
| tags | array | body | 否 | 标签数组 |
| question_markdown | string | body | 否 | 题目内容（Markdown 格式） |
| answer_simple_markdown | string | body | 否 | 简单答案（Markdown 格式） |
| answer_analysis_markdown | string | body | 否 | 详细解析（Markdown 格式） |
| subjectId | string | body | 否 | 科目 ID |
| category | string | body | 否 | 题目分类 |
| files | object | body | 否 | 文件信息对象 |

**请求示例**:

```
PUT http://localhost:3000/questions/65f1a2b3c4d5e6f789012346
Content-Type: application/json

{
  "difficulty": "hard",
  "tags": ["javascript", "async", "promise"],
  "answer_analysis_markdown": "更新后的详细解析...",
  "category": "JavaScript高级特性"
}
```

**响应示例**:

```json
{
  "success": true,
  "data": {
    "_id": "65f1a2b3c4d5e6f789012346",
    "id": "285acd89-b79b-49e6-8425-5d60d5101234",
    "type": "choice",
    "difficulty": "hard",
    "tags": ["javascript", "async", "promise"],
    "question_markdown": "async/await 的底层实现原理是什么？如何处理 async 函数中的错误？",
    "answer_simple_markdown": "async/await 是基于 Promise 的语法糖...",
    "answer_analysis_markdown": "更新后的详细解析...",
    "files": {
      "audio_simple": "path/to/audio_simple.mp3",
      "audio_question": "path/to/audio_question.mp3",
      "audio_analysis": "path/to/audio_analysis.mp3",
      "meta": "path/to/meta.json"
    },
    "subjectId": "64f1a2b3c4d5e6f789012345",
    "category": "JavaScript高级特性",
    "question_length": 50,
    "simple_answer_length": 150,
    "detailed_analysis_length": 700,
    "createdAt": "2024-05-20T10:00:00.000Z",
    "updatedAt": "2024-05-21T14:30:00.000Z"
  },
  "message": "题目更新成功"
}
```

**错误响应**:

```json
{ "success": false, "data": null, "message": "题目不存在" }
```
